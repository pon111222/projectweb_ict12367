{% extends "base.html" %}
{% block title %}<title>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</title>{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="text-center text-success fw-bold mb-4">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ mikutea</h2>

  <form method="get" class="mb-4 text-center">
    <label for="date">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
    <input type="date" id="date" name="date" value="{{ selected_date }}" class="form-control d-inline w-auto ms-2 me-2">
    <button class="btn btn-success" type="submit">‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</button>
  </form>

  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card border-success shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-success">üíµ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ selected_date }}</h5>
          <p class="card-text display-6 fw-bold">{{ total_today|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card border-secondary shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">üíº ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
          <p class="card-text display-6 fw-bold">{{ all_total|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</p>
        </div>
      </div>
    </div>
  </div>

  <h4 class="mb-3">üìÜ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ selected_date }}</h4>
  {% if today_sales %}
    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
      {% for item in today_sales %}
      <div class="col">
        <div class="card h-100 border-light shadow-sm">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <h5 class="card-title mb-1">{{ item.menu.name }}</h5>
              <small class="text-muted">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{ item.quantity }}</small>
            </div>
            <span class="badge bg-primary fs-6">{{ item.get_total_price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-warning text-center">
      üîç ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    </div>
  {% endif %}

  <hr>

  <h4 class="mb-3">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
  <ul class="list-group mb-4">
    {% for entry in daily_sales %}
      <li class="list-group-item d-flex justify-content-between">
        <span>{{ entry.day|date:"d/m/Y" }}</span>
        <strong>{{ entry.total|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</strong>
      </li>
    {% empty %}
      <li class="list-group-item">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
    {% endfor %}
  </ul>

  <h4 class="mb-3">üóìÔ∏è ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
  <ul class="list-group">
    {% for entry in monthly_sales %}
      <li class="list-group-item d-flex justify-content-between">
        <span>{{ entry.month|date:"F Y" }}</span>
        <strong>{{ entry.total|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</strong>
      </li>
    {% empty %}
      <li class="list-group-item">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
    {% endfor %}
  </ul>
  <hr>

<h4 class="mb-3">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
<div class="card shadow-sm p-4 mb-4">
  <canvas id="dailySalesChart"></canvas>
</div>

<h4 class="mb-3">üèÜ ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 5</h4>
<div class="card shadow-sm p-4 mb-4">
  <canvas id="topMenuChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
const dailySalesCtx = document.getElementById('dailySalesChart').getContext('2d');
new Chart(dailySalesCtx, {
  type: 'line',
  data: {
    labels: [{% for day in daily_sales %}"{{ day.day }}",{% endfor %}],
    datasets: [{
      label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
      data: [{% for day in daily_sales %}{{ day.total }},{% endfor %}],
      borderColor: 'blue',
      backgroundColor: 'lightblue',
      tension: 0.4,
      fill: true,
    }]
  }
});

// ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ
const topMenuCtx = document.getElementById('topMenuChart').getContext('2d');
new Chart(topMenuCtx, {
  type: 'bar',
  data: {
    labels: [{% for item in top_menus %}"{{ item.menu__name }}",{% endfor %}],
    datasets: [{
      label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ',
      data: [{% for item in top_menus %}{{ item.total_quantity }},{% endfor %}],
      backgroundColor: 'orange'
    }]
  }
});
</script>

</div>
{% endblock %}
